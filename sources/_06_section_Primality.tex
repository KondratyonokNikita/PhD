\documentclass[_00_dissertation.tex]{subfiles}
\begin{document}

\onlyinsubfile{
    \renewcommand{\contentsname}{ОГЛАВЛЕНИЕ}
    \setcounter{tocdepth}{3}
    \tableofcontents
}

\begin{center}
    \refstepcounter{chapter}
    \chapter*{ГЛАВА \arabic{chapter}.\\ ТЕСТИРОВАНИЕ ИДЕАЛОВ НА ПРОСТОТУ В ДЕДЕКИНДОВЫХ КОЛЬЦАХ}\label{chapter:Primality}
    \addcontentsline{toc}{chapter}{ГЛАВА \arabic{chapter}. ТЕСТИРОВАНИЕ ИДЕАЛОВ НА ПРОСТОТУ В ДЕДЕКИНДОВЫХ КОЛЬЦАХ}
\end{center}

\section{Предварительные сведения}

\subsection{Дедекиндовы кольца}

\begin{definition}
    \emph{Идеалом} кольца $R$ называется его подкольцо $\ideal{n}$, замкнутое относительно умножения на элементы $R$.
    А именно для любого $a \in R$ выполнено включение $a\ideal{n} \subseteq \ideal{n}$.
    Идеал $\ideal{n}$ называется \emph{тривиальным}, если он совпадает с $R$ или нулевым идеалом $0$.
    Идеал $\ideal{n}$ называется \emph{собственным}, если он не совпадает с $R$.
\end{definition}

\begin{definition}
    Собственный идеал $\ideal{n} \subset R$ называется \emph{простым}, если факторкольцо $R/\ideal{n}$ является областью целостности.
\end{definition}

\begin{definition}
    Собственный идеал $\ideal{n} \subset R$ называется \emph{максимальным}, если он не содержится ни в каком другом собственном идеале.
\end{definition}

\begin{remark}
    Любой максимальный идеал является простым.
\end{remark}

\begin{definition}
    Кольцо $R$ называется \emph{дедекиндовым}, если любой нетривиальный идеал раскладывается в произведение простых идеалов иденственным способом с точностью до порядка множителей.
\end{definition}

\begin{definition}
    \emph{Нормой} $\Nm{\ideal{n}}$ идеала $\ideal{n} \subset R$ называется мощность факторкольца $R/\ideal{n}$.

    Говорят, что дедекиндово кольцо $R$ является \emph{дедекиндовым кольцом с конечной нормой} (finite norm property), если для любого собственного идеала $\ideal{n} \subseteq R$ факторкольцо $R/\ideal{n}$ конечно.
\end{definition}

Далее в работе будем рассматривать только дедекиндовы кольца с конечной нормой.

\begin{example}
    Рассмотрим примеры дедекиндовых колец с конечной нормой.
    \begin{itemize}
        \item Пусть $K$ -- числовое поле.
        Кольцо $\mathbb{Z}_K$, образованное алгебраическими целыми элементами этого поля является дедекиндовым с конечным полем остатков.
        Частными случаями этого примера являются кольцо целых чисел и гауссовых чисел.
        
        \item Пусть $f(x, y) = y - mx - b$ -- прямая.
        Тогда $K[x, y]/(f(x, y)) \cong K[x]$.
        Следовательно, это координатное кольцо является факториальным.
        
        \item Пусть $f(x, y) = y - x^2$ -- парабола.
        Тогда $K[x, y]/(f(x, y)) \cong K[x]$.
        Следовательно, это координатное кольцо является факториальным.
    
        \item Пусть $f(x, y) = x^2 + y^2 - 1$.
        Если $K = \mathbb{Q}$, то координатное кольцо $\mathbb{Q}[x, y]/(f)$ не изоморфно $K[x]$, так как первое не является факториальным кольцом.
        Это можно показать, рассмотрев элементы $y^2 = yy$ и $1-x^2 = (1-x)(1+x)$.
        Однако, если $K = \mathbb{C}$, то координатное кольцо $\mathbb{C}[x, y]/(f) \cong \mathbb{C}[x, x^{-1}]$ уже будет факториальным, так как это локализация факториального кольца.
    \end{itemize}
\end{example}

\begin{definition}
    Идеал $\ideal{n}$ называется \emph{главным}, если $\ideal{n} = aR$, где $a \in R$.
    Если все идеалы кольца $R$ являются главными, то говорят, что $R$ \emph{кольцо главных идеалов}.
\end{definition}

\begin{definition}
    \emph{Произведением} двух идеалов $\ideal{a}$ и $\ideal{b}$ называется идеал, порожденный всеми произведениями $ab$, где $a \in \ideal{a}$, $b \in \ideal{b}$.
\end{definition}

\begin{definition}
    Пусть $a, b \in R$ и $\ideal{n} \subseteq R$.
    Будем говорить, что $a$ \emph{сравнимо} с $b$ по модулю $\ideal{n}$ и писать $a \equiv b \pmod{\ideal{n}}$, если $a - b \in \ideal{n}$.
\end{definition}

\begin{definition}\cite{source:Petukhova}
    Функцией Эйлера нетривиального идеала $\ideal{n} \subset R$ называется функция
    \begin{equation*}
        \varphi(\ideal{n}) = \left|
            \invertible{(R/\ideal{n})}
        \right|.
    \end{equation*}
\end{definition}

\begin{statement}[Обобщенная теорема Эйлера]\cite{source:Petukhova}
    Пусть $m \in R$ и $\ideal{n} \subset R$ --- идеал.
    Если $Rm + \ideal{n} = R$, то
    \begin{equation*}
        m^{\varphi(\ideal{n})}\equiv 1 \pmod{\ideal{n}}.
    \end{equation*}
\end{statement}

\begin{definition}
    \emph{Первообразным корнем по модулю идеала} $\ideal{n}$ будем называть такой элемент $g \in R$, что $g^{\varphi (\ideal{n})} \equiv 1 \pmod{\ideal{n}}$ и $g^{l} \not\equiv 1 \pmod{\ideal{n}}$ при $1 \leq l < \varphi(\ideal{n})$.
\end{definition}

\begin{statement}[Обобщенная китайская теорема об остатках]\label{statement:chinese_remainder_theorem}
    Пусть $\ideal{n}_1, \ideal{n}_2, \dots, \ideal{n}_k$ -- попарно взаимнопростые идеалы кольца $R$.
    Тогда
    \begin{equation*}
        \begin{split}
            R/(\ideal{n}_1\ideal{n}_2\dots\ideal{n}_k) \cong & (R/\ideal{n}_1) \times (R/\ideal{n}_2) \times \dots \times (R/\ideal{n}_k)\\
            \invertible{R/(\ideal{n}_1\ideal{n}_2\dots\ideal{n}_k)} \cong & \invertible{R/\ideal{n}_1} \times \invertible{R/\ideal{n}_2} \times \dots \times \invertible{R/\ideal{n}_k}
        \end{split}
    \end{equation*}
\end{statement}

\begin{definition}
    Элемент $a \in R$ будем называть \emph{квадратичным вычетом по модулю идеала} $\ideal{n}$, если существует $b \in R$, что $b^2 \equiv a \pmod{\ideal{n}}$.

    Для простого идеала $\ideal{p}$ и $a \in \invertible{R/\ideal{p}}$ определим \emph{символ Лежандра} следующим образом
    \begin{equation*}
        \jacobi{a}{\ideal{p}} = \begin{cases}
            1, \textrm{ если } a \textrm{ квадратичный вычет по модулю } \ideal{p}\\
            -1, \textrm{ иначе}.
        \end{cases}
    \end{equation*}

    Для нетривиального идеала $\ideal{n} = \ideal{p}_1  \dots \ideal{p}_k$ и $a \in \invertible{R/\ideal{n}}$ определим \emph{символ Якоби} следующим образом
    \begin{equation*}
        \jacobi{a}{\ideal{n}} = \left(\frac{a}{\ideal{p}_1}\right) \dots \left(\frac{a}{\ideal{p}_k}\right)
    \end{equation*}
\end{definition}

\begin{definition}
    \emph{Расширение поля} $K$ это такое поле $E$, которое содержит поле $K$ в качестве подполя.
    Для любого расширения $E \supset K$ поле $E$ является векторным пространством над полем $K$.
    Размерность этого векторного пространства называется \emph{степенью расширения} и обозначается $[E:K]$.
    Говорят, что $E \supset K$ \emph{конечное расширение}, если его степень конечна.
\end{definition}

\begin{definition}
    Пусть $E$ расширение поля $K$.
    Элемент $E$ называется \emph{алгебраическим} над $K$, если он является корнем ненулевого многочлена с коэффициентами в $K$.
    Элементы, не являющиеся алгебраическими, называются \emph{трансцендентными}.
    
    Если каждый элемент расширения $E \supset K$ является алгебраическим над $K$, то $E \supset K$ называется \emph{алгебраическим расширением}. 
\end{definition}

\begin{definition}
    Алгебраическое расширение $E \supset K$ называется \emph{нормальным}, если каждый неприводимый многочлен $f(x)$ над $K$, имеющий хотя бы один корень в $E$, разлагается в $E$ на линейные множители.

    Алгебраическое расширение $E \supset K$ называется \emph{сепарабельным}, если каждый элемент $E$ является сепарабельным, то есть его минимальный многочлен не имеет кратных корней.
    В частности, теорема о примитивном элементе утверждает, что любое конечное сепарабельное расширение имеет примитивный элемент.
    
    Расширение $E \supset K$ называется \emph{расширением Галуа}, если оно одновременно сепарабельное и нормальное.

    Для любого расширения $E \supset K$ можно рассмотреть группу автоморфизмов поля $E$, действующих тождественно на поле $K$.
    Когда расширение является расширением Галуа, эта группа называется \emph{группой Галуа} данного расширения и обозначается $\Gal{L/K}$.
\end{definition}

Пусть $R$ дедекиндово кольцо с полем частных $K$.
Пусть расширение $L \supset K$ конечное, сепарабельное и нормальное расширение, а $\Gal{L/K}$ является абелевой.
Положим $S$ алгебраическое замыкание $R$ в $L$.

\begin{definition}
    Пусть $\ideal{p}$ простой идеал кольца $R$.
    Рассмотрим идеал $\ideal{p}S$, который он генерирует в кольце $S$.
    Этот идеал не обязан быть простым, но существует единственная факторизация его на простые идеалы
    \begin{equation*}
        \ideal{p}S = \prod_{\ideal{q}} \ideal{q}^{e_{\ideal{q}}},
    \end{equation*}
    где произведение берется по всем простым идеалам кольца $S$ и $e_{\ideal{q}} > 0$ только для конечного количества простых $\ideal{q}$.
    Если $e_{\ideal{q}} > 0$ для некоторого $\ideal{q}$, то говорят, что $\ideal{q}$ лежит над (lie over, lie above) простым идеалом $\ideal{p}$.

    Число $e_{\ideal{q}}$ из разложения $\ideal{p}S = \prod_{\ideal{q}} \ideal{q}^{e_{\ideal{q}}}$ называется \emph{индексом разветвления} (ramification index) $\ideal{q}$.

    Если для простого идеала $\ideal{p} \subseteq R$ выполнено $e_{\ideal{q}} > 1$ для некоторого $\ideal{q} \subseteq S$, то говорят, что идеал $\ideal{p}$ \emph{ветвится} в $L$.
    Если идеал $\ideal{p}S$ простой в $S$, то говорят, что $\ideal{p}$ \emph{инертный} (inert).
    Если для всех $\ideal{q}$ выполняется или $e_{\ideal{q}} = 0$, или $e_{\ideal{q}} = 1$, то говорят, что $\ideal{p}$ \emph{полностью разлагается} (splits completely) в $L$.
\end{definition}

\begin{definition}
    Пусть $\ideal{p}$ простой идеал кольца $R$, не ветвящийся в $L$ и пусть $\ideal{P} = \ideal{p}S$ соответствующий идеал в $S$.
    Тогда существует единственный такой элемент $\sigma \in \Gal{L/K}$, что для любого $\alpha \in L$
    \begin{equation*}
        \sigma(\alpha) \equiv \alpha^{\Nm{\ideal{p}}} \pmod{\ideal{P}}.
    \end{equation*}
    Этот элемент называют \emph{символом Артина} идеала $\ideal{p}$.
\end{definition}

\begin{definition}
    Пусть $\phi: \Gal{L/K} \to \invertible{\mathbb{C}}$ гомоморфизм.
    Рассмотрим функцию
    \begin{equation*}
        \chi(\ideal{p}) = \begin{cases}
            \phi(\sigma_{\ideal{p}}), & \textrm{если } \ideal{p} \textrm{ не ветвится}\\
            0, & \textrm{иначе}
        \end{cases}
    \end{equation*}
    где $\ideal{p}$ простой и $\sigma_{\ideal{p}}$ символ Артина идеала $\ideal{p}$.
    Используя мультипликативность, эту функцию можно определить для всех идеалов $R$.
    Полученную функцию $\chi$ будем называть \emph{характером}.
    Характер принимающий только значения $0$ и $1$ называется \emph{главным}.
\end{definition}

\begin{definition}
    Будем говорить, что характер $\chi$ \emph{задан по модулю идеала} $\ideal{f} \subset R$, если для всех идеалов $\ideal{n} \subseteq R$, из сравнения $\ideal{n} \equiv 1 \pmod{\ideal{f}}$ следует равенство $\chi(\ideal{n}) = 1$.
\end{definition}

\subsection{Факториальные кольца}

\begin{definition}
    Кольцо $R$ называется \emph{факториальным}, если каждый его ненулевой элемент $x \in R$ либо обратим, либо однозначно представляется в виде произведения неприводимых элементов с точностью до перестановки множителей.

    Факториальное кольцо является кольцом главных идеалов.
    Далее рассматривая идеалы факториальных колец будем писать элементы, порождающие эти идеалы.
\end{definition}

\begin{definition}
    Пусть $R$ факториальное кольцо.
    Функцию $\elementnorm{\cdot}: R \to \mathbb{N} \cup \{0, -\infty\}$ будем называть нормой в $R$, если
    \begin{itemize}
        \item $\elementnorm{x} = -\infty$ тогда и только тогда, когда $x = 0$;

        \item $\elementnorm{xy} \ge \elementnorm{x}$;

        \item для $x, y \in \zeroless{R}$ равенство $\elementnorm{xy} = \elementnorm{x}$ выполнено тогда и только тогда, когда $y \in \invertible{K}$.
    \end{itemize}
\end{definition}

\begin{remark}
    Для любого факториального кольца $R$ можно определить норму.
    Рассмотрим разложение элемента $x$ на простые множители $x = \varepsilon p_1^{\alpha_1} \dots p_k^{\alpha_k}$, где $\varepsilon \in \invertible{R}$, $p_1, \dots, p_k$ -- простые элементы $R$.
    Тогда функция
    \begin{equation*}
        \elementnorm{x} = \left\{\begin{split}
            \sum_{i=1}^k \alpha_{i}, & \textrm{ если } x \neq 0\\
            -\infty, & \textrm{ если } x = 0
        \end{split}\right.
    \end{equation*}
    является нормой в $R$.
\end{remark}

Далее будем считать, что факториальное кольцо $R$ задано вместе с нормой $\elementnorm{\cdot}$.

\begin{definition}
    Пусть $R$ факториальное кольцо и $F$ его поле частных.
    Функцию $\fr{\cdot}: F \to F$ будем называть дробной частью в $F$, если
    \begin{itemize}
        \item $\fr{\alpha + q} = \fr{\alpha}$ для любых $\alpha \in F$, $q \in R$;

        \item если $m \in R$, $n \in \zeroless{R}$ и $(m, n) = 1$, то $\fr{m/n} = r/n$, где $r \in R$, $(m-r)/n \in R$ и $\elementnorm{r} = \min \{\elementnorm{s} | s \in R, (m-s)/n \in R\}$.
    \end{itemize}
    Функцию $\int{\cdot}: F \to R$ будем называть целой частью, если
    \begin{equation*}
        \int{\alpha} = \alpha - \fr{\alpha}.
    \end{equation*}
\end{definition}

\begin{definition}
    Обозначим через $F_1$ множество всех несократимых дробей $F$
    \begin{equation*}
        F_1 = \{
            \alpha \in F \big| \alpha = \fr{\alpha}
        \}.
    \end{equation*}
\end{definition}

\begin{remark}\label{remark:easy_fr}
    Для любого факториального кольца $R$ можно определить дробную и целую часть.
    Рассмотрим произвольный элемент $X \in F/R$.
    Этот элемент можно представить в виде $X = \{m/n + t | t \in R\}$, где $m \in R$, $n \in \zeroless{R}$ $(m, n) = 1$.
    Существует элемент $t_0 \in R$, минимизирующий норму $\elementnorm{m + n t_0}$.
    Тогда для любого элемента $x \in X$ положим
    \begin{equation*}
        \fr{x} = m/n + t_0.
    \end{equation*}

    Несложно заметить, что эта функция является дробной частью.
    Целую часть определим следующим образом
    \begin{equation*}
        \int{x} = x - \fr{x}.
    \end{equation*}
\end{remark}

Далее будем считать, что факториальное кольцо $R$ задано вместе дробной частью $\fr{\cdot}$ и целой частью $\int{\cdot}$.

\subsection{Числовые кольца}

Пусть $K$ -- числовое поле со степенью расширения равной $n$.
Пусть $R = \mathbb{Z}_K$ -- кольцо алгебраических целых элементов поля $K$.
И пусть $(e_i)_{1 \le i \le n}$ -- базис $\mathbb{Z}_K$.
Будем считать, что группа $\invertible{\mathbb{Z}_K}$ бесконечна и образована $r$ фундаментальными единицами и корнями единицы в $K$.
Будем обозначать их через $\{\varepsilon_1, \dots, \varepsilon_r\}$ и считать, что они известны.
Обозначим $\nu$ -- генератор корней из единицы в $K$ порядка $l$.

Введем норму $\elementnorm{\cdot}$ в кольце $R$.
Обозначим через $N_{K/\mathbb{Q}}$ норму в числовом поле $K$.
Далее будем полагать, что $\mathbb{Z}_K$ евклидово по отношению к норме $N_{K/\mathbb{Q}}$.

\begin{definition}
    Для любого $a \in \zeroless{R}$ обозначим через $\overline{a} \in \zeroless{R}$ сопряжённый элемент определяемый как $\overline{a} = \elementnorm(a)/a$.
\end{definition}

Через $(\sigma_i)_{1 \le i \le n}$ обозначим вложения $K$ в $\mathbb{C}$.
Пусть $\sigma_i$ для $1 \le i \le r_1$ является действительным, а для $r_1 < i < r_1 + r_2$ мнимым и $\sigma_{i+r_2} = \overline{\sigma_{i}}$.
Определим функцию $\Phi(x): K \to \mathbb{R}^n$ следующим образом
\begin{equation*}
    \Phi(x) = \left(
        \sigma_1(x), \ldots, \sigma_{r_1}(x),
        \mathcal{R}\sigma_{r_1 + 1}(x), \ldots, \mathcal{R}\sigma_{r_1 + r_2}(x),
        \mathcal{I}\sigma_{r_1 + 1}(x), \ldots, \mathcal{I}\sigma_{r_1 + r_2}(x)
    \right)
\end{equation*}

Пусть $x, y \in \mathbb{R}^n$, $x = (x_i)_{1 \le i \le n}$ и $y = (y_i)_{1 \le i \le n}$.
Определим произведение в $\mathbb{R}^n$ следующим образом
\begin{equation*}
    (xy)_i =
    \begin{cases}
        x_i y_i                       & \textrm{ если } 1 \le i \le r_1,\\
        x_i y_i - x_{i+r_2} y_{i+r_2} & \textrm{ если } r_1 < i \le r_1+r_2,\\
        x_{i-r_2} y_i - x_i y_{i-r_2} & \textrm{ если } r_1+r_2 < i \le n.
    \end{cases}
\end{equation*}

Обозначим через $\mathcal{N}:\mathbb{R}^n \to \mathbb{R}$ норму в $\mathbb{R}^n$.
По определению считаем, что
\begin{equation*}
    \mathcal{N}(x) = \prod\limits_{i=1}^{r_1} x_i \prod\limits_{i=r_1+1}^{r_1+r_2} (x_i^2 + x_{i+r_2}^2).
\end{equation*}

Заметим, что для любых $x, y\in \mathbb{R}^n$ выполнено $\mathcal{N}(xy) = \mathcal{N}(x)\mathcal{N}(y)$.
А так же для любых $\xi\in K$ выполнено $N_{K/\mathbb{Q}}(\xi) = \mathcal{N}(\Phi(\xi))$.
Далее можно определить $\elementnorm{\cdot}: \mathbb{Z}_K \to \mathbb{N} \cup \{0, -\infty\}$ следующим образом.
\begin{equation*}
    \elementnorm{\xi} = \begin{cases}
        -\infty & \textrm{ если } x = 0,\\
        \mathcal{N}(\Phi(\xi)) & \textrm{ если } x \in \zeroless{R},\\
    \end{cases}
\end{equation*}
Заметим, что тогда $\mathbb{Z}_K$ является евклидовым относительно нормы $\elementnorm{\cdot}$.

Дробную часть $\fr{\cdot}$ в $K$ введем аналогично замечанию~\ref{remark:easy_fr}.

\begin{definition}
    Для $\xi \in K$ обозначим через $\int{\xi} \in \mathbb{Z}_K$ такой элемент, что
    \begin{equation*}
        \inf\limits_{z\in\mathbb{Z}_K} |\mathcal{N}(\Phi(\xi) - \Phi(z))| = |\mathcal{N}(\Phi(\xi) - \Phi(\int{\xi}))|.
    \end{equation*}
    Для $\xi \in K$ обозначим через $\fr{\xi} = \xi - \int{\xi}$.
\end{definition}

Из доказанного в работе~\cite{source:Lezowski} следует, что получающееся определение дробной части корректно.

\begin{statement}\label{statement:orbit}\cite{source:Lezowski}
    Пусть $x \in \mathbb{R}^n$.
    Обозначим
    \begin{equation*}
        m_{\overline{K}}(x) = \inf_{z\in\mathbb{Z}_K} |\mathcal{N}(x - \Phi(z))|.
    \end{equation*}
    Тогда для любого $\varepsilon \in \invertible{\mathbb{Z}_K}$, $Z \in \Phi(\mathbb{Z}_K)$ выполнено
    \begin{equation*}
        m_{\overline{K}}(\Phi(\varepsilon)x - Z) = m_{\overline{K}}(x).
    \end{equation*}
\end{statement}

\begin{definition}
    Пусть $x\in \mathbb{R}^n$.
    Обозначим
    \begin{equation*}
        \mathcal{F} = \left\{
            \sum\limits_{i=1}^n x_i\Phi(e_i) \Big| x_i \in \mathbb{Q}\cap[0, 1)
        \right\}
    \end{equation*}
    Определим \emph{орбиту элемента} $x$ следующим образом 
    \begin{equation*}
        \textrm{Orb}(x) = \left\{
        \Phi(\varepsilon)x - z \in \mathcal{F} \Big| \varepsilon \in \invertible{\mathbb{Z}_K}, z \in \mathbb{Z}_K
    \right\}.
    \end{equation*}
\end{definition}

Из утверждения \ref{statement:orbit} следует, что функция $m_{\overline{K}}$ принимает одно значение на всех элементах орбиты.

\begin{statement}\cite{source:Lezowski}
    Для любого элемента $x\in \mathbb{R}^n$ орбита $\textrm{Orb}(x)$ конечна тогда и только тогда, когда $x \in \Phi(K)$.
\end{statement}

\begin{definition}
    Для всех $1 \le i \le n$ обозначим
    \begin{equation*}
        \Gamma_i = \prod\limits_{j=1}^r \max\left\{
            |\sigma_i(\varepsilon_j)|, \frac{1}{|\sigma_i(\varepsilon_j)}
        \right\}.
    \end{equation*}

    А так же определим
    \begin{equation*}
        \Gamma(k) =
        \begin{cases}
            \left(
                \prod\limits_{j=1}^{n-1} \Gamma_j
            \right)^{\frac{1}{n}} k^{\frac{1}{n}}\ \textrm{если}\ K\ \textrm{действительное},\\
            \left(
                \prod\limits_{j=1}^{r_1} \Gamma_j \prod\limits_{j=1}^{r_1+r_2-1} \Gamma_j \Gamma_{j+r_2}
            \right)^{\frac{1}{n}} k^{\frac{1}{n}}\ \textrm{иначе},
        \end{cases}
    \end{equation*}
    где $k>0$.
\end{definition}

\begin{statement}\label{proposition:division_with_least_norm_remainder}\cite{source:Lezowski}
    Пусть $x \in \Phi(K)$ и $k > 0$.
    Для каждого $z \in \textrm{Orb}(x)$ обозначим
    \begin{equation*}
        \mathcal{I}_{z, k} = \{Z \in \Phi(\mathbb{Z}_K): |z_i-Z_i| \le \Gamma(k) \forall i, 1 \le i \le n\},
    \end{equation*}
    \begin{equation*}
        \mathcal{M}_k = \min\limits_{z \in \textrm{Orb}(x)} \min\limits_{Z \in \mathcal{I}_{z, k}} |\mathcal{N}(z-Z)|.
    \end{equation*}

    Тогда, если $\mathcal{M}_k \le k$, то $m_{\overline{K}}(x) = \mathcal{M}_k$.
\end{statement}

\begin{definition}
    Пусть $\ideal{n} \subseteq R$ произвольный идеал кольца $R$.
    Тогда существуют элементы $\alpha_1, \dots, \alpha_r \in R$ для $r \leq n$, что
    \begin{equation*}
        \ideal{n} = \{\xi_1 \alpha_1 + \dots + \xi_r \alpha_r | \xi_i \in R\}.
    \end{equation*}
    
    Такое представление будем обозначать $\ideal{n} = (\alpha_1, \dots, \alpha_r)$ и называть \emph{базисным представлением идеала}.
\end{definition}

\begin{definition}
    Пусть $\ideal{n} \subseteq R$ произвольный идеал кольца $R$.
    Тогда существуют элементы $e_1, \dots, e_r \in R$ для $r \leq n$, что
    \begin{equation*}
        \ideal{n} = \{x_1 e_1 + \dots + x_m e_m | x_i \in \mathbb{Z}\}.
    \end{equation*}

    Такое представление будем обозначать $\ideal{n} = (e_1, \dots, e_n)_{\mathbb{Z}}$ и называть \emph{$\mathbb{Z}$-представлением идеала}.
    Для оценки трудоемкости операций над идеалами $\mathbb{Z}$-представление будем записывать как матрицу $A \in \mathbb{\mathbb{Z}}^{n \times n}$, такую что её столбец под номером $i$ - это коэффициенты разложения $e_i$ в фиксированный целый базис $R$.
\end{definition}

\begin{statement}\cite{source:Cohen, source:Post}
    Любой идеал имеет $\mathbb{Z}$-представление.
\end{statement}

\begin{definition}
    Пусть $\ideal{n} \subseteq R$ произвольный идеал кольца $R$.
    Тогда существуют элементы $a \in \mathbb{N} \cup \{0\}$ и $\alpha \in R$, что 
    \begin{equation*}
        \ideal{n} = \{a \xi_1 + \alpha \xi_2 | \xi_1, \xi_2 \in \mathcal{O}_K\}.
    \end{equation*}

    Такое представление будем обозначать $\ideal{n} = (a, \alpha)_2$ и называть \emph{$2$-представлением идеала}.
    Для оценки трудоемкости операций над идеалами $2$-представление будем записывать как вектор из $\mathbb{Z}^n$ состоящий из коэффициентов разложения $\alpha$ в целый базис и целого неотрицательное число $a$.
    $2$-представление является частным случаем базисного представления и любое $2$-представление задаёт идеал.
\end{definition}

\begin{statement}\cite{source:Cohen, source:Post}
    Любой идеал имеет 2-представление.
\end{statement}

\begin{statement}\cite{Post}
    Существует полиномиальный алгоритм перехода от $2$-представления к $\mathbb{Z}$-представлению и обратно.
\end{statement}

\begin{remark}
    Несмотря на полиномиальность алгоритма, он может оказаться достаточно трудоёмким.
\end{remark}

Важной операцией над идеалами является их сравнение.
Так как $\mathbb{Z}$-представление идеала можно записать как матрицу, то можно рассмотреть следующий способ записи $\mathbb{Z}$-представления идеала.

\begin{definition}
    Будем говорить, что матрица $A \in \mathbb{Z}^{n \times n}$ записана в нормальной эрмитовой форме, если выполнены следующие условия:
    \begin{enumerate}
        \item $A_{i, j} = 0$, если $i > j$.
        
        \item $A_{i,i} > 0$ для любого $i$.
        
        \item Для любого $i > j$ выполнено $0 \leq A_{i, j} \leq A_{i, i}$.
    \end{enumerate}
\end{definition}

\begin{definition}
    Будем говорить, что $\mathbb{Z}$-представление идеала $\ideal{a} = (e_1,\dots,e_n)_{\mathbb{Z}}$ находится в нормальной эрмитовой форме, если соответствующая матрица является матрицей в эрмитовой нормальной форме.
\end{definition}

\begin{statement}\cite{Cohen, Post}
    Любой идеал может быть записан в нормальной эрмитовой форме, причём такое представление единственно.
\end{statement}

\begin{statement}\cite{PolynomialHermitForm}
    Существует полиномиальный алгоритм получения представления идеала в нормальной эрмитовой форме из его $\mathbb{Z}$-представления.
\end{statement}

\begin{corollary}
    Существуют алгоритмы для получения $\mathbb{Z}$-представления, 2-представления или представления в нормальной эрмитовой форме из любого из этих представлений.
\end{corollary}

\begin{definition}
    Пусть $\ideal{n}$ идеал кольца $R$ с целым базисом $E$.
    Пусть $\ideal{n} = (e_1, \dots, e_n)_{\mathbb{Z}}$.
    Обозначим
    \begin{equation*}
        l(\ideal{n}) = \max\limits_{i = \overline{1,n}, j = \overline{1,n}} |a_{ij}|, 
    \end{equation*}
    где $A = (a_{ij}) \in \mathbb{Z}^{n \times n}$ матрица соответствующая указанному $\mathbb{Z}$-представлению.
    Значение $l(\ideal{n})$ будем называть \emph{абсолютным значением идеала}.
    Логарифм абсолютного значения идеала характеризует количество памяти необходимое для того, чтобы закодировать его $\mathbb{Z}$-представление.
\end{definition}

\begin{remark}
    Если кольцо $R$ факториальное, любой идеал является главным, а значит любой идеал может быть задан с помощью порождающего его элемента.
    В таких кольцах идеал, как и любой элемент, будет кодироваться в виде вектора $\mathbb{Z}^n$ коэффициентов разложения в целый базис кольца $R$.
\end{remark}

\begin{remark}
    В работе используется оценка сложности перемножения двух натуральных чисел, получаемая из алгоритма Шенхаге-Штрассена~\cite{source:Schonhage}.
    Для упрощения записи оценки сложности алгоритмов в работе введем следующее обозначение.
    Пусть $f(L),$ $g(L)$ две различные функции натурального аргумента $L$.
    Будем писать $f(L) = \tilde O(g(L))$, если существует положительная функция $h(L)$, такая что $f(L) \le h(L)g(L)$ для любых $L \in \mathbb{N}$, и $h(L) = O(\log g(L)\log \log g(L))$.
    
    Любое положительная действительное число $C$ будем называть эффективно вычислимой константной, если оно зависит только от инвариантов поля $K$ и существует алгоритм нахождения данного числа.
\end{remark}

Далее предполагаем, что элементы заданы с помощью коэффициентов своего разложения в целый базис $R$.

\begin{proposition}\label{proposition:operations}
    Пусть $a, b \in \zeroless{R}$ и $l(a) \leq L$, $l(b) \leq L$, тогда $a + b$, $a b,$ $b/a$ (включая проверку условия $a|b$), $\elementnorm{a}$, $\overline{a}$ могут быть  вычислены за $\tilde{O}(\log L)$ бинарных операций.
\end{proposition}
\begin{proof}
    Пусть
    \begin{equation*}
        \begin{split}
            a = \sum_{i = 1}^n \alpha_i e_i\\
            b = \sum_{i = 1}^n \beta_i e_i.
        \end{split}
    \end{equation*}

    Утверждение для суммы $a + b$ следует из того факта, что
    \begin{equation*}
        a + b = \sum_{i = 1}^n (\alpha_i + \beta_i) e_i.
    \end{equation*}

    Аналогично получаем, что утверждение верно для произведения $ab$.
    Для перемножения чисел используем алгоритм Шанхаге-Штрассена быстрого перемножения чисел.

    Пусть $A = (a_{ij}) \in \mathbb{Z}^{n \times n}$ матрица, такая что $a e_i = \sum_{j = 1}^n a_{ij}e_j$ ($i=1,\ldots,n$).
    Из того, что $\elementnorm{a} = |\det{A}|$ следует, что норма $\elementnorm{a}$ может быть найдена с помощью операций сложения и умножения за $\tilde{O}(\log L)$ бинарных операций.

    Рассмотрим разложение сопряженного элемента по целому базису $\overline{a} = \sum_{i = 1}^n x_i e_i,$ где $x_i$ неизвестные целые коэффициенты.
    Тогда
    \begin{equation*}
        \elementnorm{a} = a \overline{a} = \sum_{i, j = 1}^n  \alpha_i x_j e_i e_j =
            \sum_{k = 1}^n \left(
                \sum_{i = 1}^n \sum_{j = 1}^n \alpha_i x_j \alpha_{k, i, j}
            \right) e_k,
    \end{equation*}
    где $e_i e_j = \sum_{k=1}^n \alpha_{k, i, j} e_k$.
    Тогда выполнено соотношение
    \begin{equation*}
        H(x_1, x_2, \ldots, x_n)^T = (\elementnorm{a}, 0, \ldots, 0)^T,
    \end{equation*}
    где $H \in \mathbb{Z}^{n \times n}$ матрица элементов $h_{i, j} \in \mathbb{Z}$, такая что $h_{i, j} = O(L)$.
    Тогда существует константа $D$, такая что $\elementnorm(a) \le D l(a)^n$.
    Следовательно, решение $(x_1, x_2, \ldots, x_n)^T$ может быть найдено за $\tilde{O}(\log L)$ бинарных операций.

    Из определения сопряженного следует, что $b/a = \frac{b\overline{a}}{\elementnorm(a)}$.
    Тогда $a|b$ тогда и только тогда, когда $\elementnorm(a)|y_i$ для любых $i = 1, \ldots, n$, где $b\overline{a} = \sum_{i=1}^n y_i e_i$, $y_i \in \mathbb{Z}$.
    Следовательно, элемент $b/a$ может быть определён за $\tilde{O}(\log L)$ используя произведение в $\mathcal{O}_K$ и деление рациональных чисел. 
\end{proof}

\begin{remark}
    Из доказательства предложения~\ref{proposition:operations} следует, что существует константа $D$, такая что $\elementnorm(a) \leq D l(a)^n$ для любого $a \in R$.
    Следовательно, по правилу Крамера, существуют константы $E$ и $q$, такие что $l(\overline{a}) \leq E L^q$ для любого $a \in R$.
\end{remark}

\begin{proposition}\label{proposition:mod}
    Существует константа $M$, такая что для любых $a, m \in \zeroless{R}$, $l(a) \leq L, l(m) \leq L$ за $\tilde{O}(\log L)$ бинарных операций может быть найдено $z \in R$, удовлетворяющее условию $a \equiv z \pmod{m}$ и $l(z) \leq M l(m)$.
    Такое $z$ будем обозначать $a \pmod{m}$.
\end{proposition}
\begin{proof}
    Пусть
    \begin{equation*}
        \begin{split}
            a = \sum_{i=1}^n a_i e_i\\
            m = \sum_{i=1}^n m_i e_i.
        \end{split}
    \end{equation*}
    
    Тогда
    \begin{equation*}
        \frac{a}{m} = \frac{a\overline{m}}{\elementnorm{m}} =
            \frac{1}{\elementnorm{m}}\sum\limits_{i=1}^n b_i e_i =
            \sum\limits_{i=1}^n \left\lfloor
                \frac{b_i}{\elementnorm{m}}
            \right\rfloor e_i + \sum\limits_{i=1}^n \frac{b_i'}{\elementnorm{m}} e_i,
    \end{equation*}
    где $b_i' \in \mathbb{Z}$, $|b_i'| < \elementnorm{m}$, $i = 1, \ldots, n$.
    Из того, что
    \begin{equation*}
        a\overline{m} \equiv \sum_{i=1}^n b_i' e_i \pmod{\elementnorm{m}}
    \end{equation*}
    следует, что $\overline{m} \big| \sum_{i=1}^n b_i' e_i$.
    Тогда $a \equiv z \pmod{m}$, где
    \begin{equation*}
        z = \frac{1}{\overline{m}}\sum_{i=1}^n b_i' e_i = \frac{1}{\elementnorm{m}}\sum_{k=1}^n e_k\left(
            \sum_{i, j = 1}^n b_i' m_j \alpha_k^{i, j}
        \right)
    \end{equation*}

    Получаем
    \begin{equation*}
        \begin{split}
            l(z) = \max_{k = \overline{1, n}} \left|
                \frac{1}{\elementnorm{m}}\sum_{i, j = 1}^n b_i' m_j \alpha_k^{i, j}
            \right| < \max_{k = \overline{1, n}} \sum_{i, j = 1}^n |m_j \alpha_k^{i, j}| \le\\
            \le l(m) \max_{k = \overline{1, n}} \sum_{i, j = 1}^n |\alpha_k^{i, j}| = M l(m).
        \end{split}
    \end{equation*}

    Из того, что $l(a) \leq L, l(m) \leq L$ следует, что $l(\overline{m}) \le E L^q,$ где $q$ и $E$ эффективно вычислимые константы.
    Так как существует константа $D$, такая что $\elementnorm{m} \le D l(m)^n$, числа $b_i$, $b_i'$ могут быть найдены за $\tilde{O}(\log L)$ бинарных операций.
    Поэтому элемент $z$ может быть найден используя не более $\tilde{O}(\log L)$ бинарных операций.
\end{proof}

\begin{corollary}\label{corollary:mod}
    Пусть $k \in \mathbb{N}$, и для $a, b, m \in \zeroless{R}$ выполнено $l(a) \leq L$, $l(b) \leq L$, $l(m) \leq L$.
    Тогда $a + b \pmod{m}$ и $a^k \pmod{m}$ могут быть определены за $\tilde{O}(\log L)$, $\tilde{O}(\log k \log L)$  бинарных операций соответственно.
\end{corollary}

\begin{proposition}\label{proposition:equality}
    Пусть идеалы $\ideal{a}$ и $\ideal{b}$ заданы в виде нормальной эрмитовой формы и $l(\ideal{a}), l(\ideal{b}) \leq L$.
    Тогда проверка равенства $\ideal{a} = \ideal{b}$ может быть выполнена за $O(\log L)$ бинарных операций.
\end{proposition}
\begin{proof}
    Из того, что любой идеал однозначно задаётся своей нормально эрмитовой формой следует, что достаточно проверить на поэлементное равенство две целочисленные матрицы размера $n \times n$ с коэффициентами размера $O(L)$.
\end{proof}

\begin{proposition}\label{proposition:particular_equality}
    Пусть $\ideal{p} = (\alpha, a)_2$ -- простой идеал, заданный в виде 2-представления, а $\ideal{n}$ произвольный идеал заданный в виде $\mathbb{Z}$-представления, причём $l(\ideal{p}), l(\ideal{n}) \leq L$.
    Тогда проверка равенства $\ideal{p} = \ideal{n}$ может быть выполнена за $\tilde{O}(\log L)$ операций.
\end{proposition}
\begin{proof}
    Равенство $\ideal{p} = \ideal{n}$ выполняется тогда и только тогда, когда $\ideal{p}$ делится на $\ideal{n}$, что равносильно включению $\ideal{p}$ в $\ideal{n}$.
    Для проверки включения достаточно  и необходимо проверить, что $\alpha, a \in \ideal{n}$.
    Эта проверка сводится к проверке разрешимости систем линейных уравнений размера $n \times n$ с коэффициентами размера $O(L)$, что может быть выполнено за $\tilde{O}(\log L)$ бинарных операций.
\end{proof}

\begin{proposition}\label{proposition:norm}
    Пусть идеал $\ideal{a}$ задан в виде $\mathbb{Z}$-представления и $l(\ideal{a}) \leq L$.
    Тогда норма $\Nm(\ideal{a})$ может быть вычислена за $\tilde{O}(\log L)$ бинарных операций.
\end{proposition}
\begin{proof}
    В работе Поста~\cite{Post}, доказано, что $\Nm{\ideal{a}} = |\mathrm{det}(A)|$, где $A$ матрица соответствующая $\mathbb{Z}$-представлению $\ideal{a}$.
    Определитель целочисленной матрицы размера $n \times n$ с коэффициентами размера $O(L)$ может быть вычислен за $\tilde{O}(\log L)$ бинарных операций.
\end{proof}

\begin{proposition}\label{proposition:congruence}
    Пусть идеал $\ideal{a}$ задан в виде $\mathbb{Z}$-представления и $l(\ideal{a}), l(a), l(b) \leq L$, то проверка сравнения $a \equiv b \pmod{\ideal{a}}$ может быть выполнена за $\tilde{O}(\log L)$ бинарных операций.
\end{proposition}
\begin{proof}
    Сравнение $a \equiv b \pmod{\ideal{a}}$ выполняется тогда и только тогда, когда $\ideal{a} | (a - b)$.
    Это эквивалентно проверке включения главного идеала $(a - b)$ в идеал $\ideal{a}$, что выполняется тогда и только тогда, когда $a - b \in \ideal{a}$.
    Эта проверка сводится к проверке разрешимости систем линейных уравнений размера $n \times n$ с коэффициентами размера $O(L)$, что может быть выполнено за $\tilde{O}(\log L)$ бинарных операций.
\end{proof}

\begin{proposition}\label{proposition:residue_modulo_ideal}
    Пусть нетривиальный идеал $\ideal{n}$ задан с помощью $\mathbb{Z}$-представления и $l(\ideal{n}) \leq L$.
    Пусть $a \in R$ и $l(a) \leq L$.
    Тогда за $\tilde{O}(\log L)$ бинарных операций можно найти $z \in R$, такое что $z \equiv a \pmod{\ideal{n}}$ и $l(z) \leq N l(\ideal{n})^n$.
    Такое $z$ будем обозначать $a \pmod{m}$.
\end{proposition}
\begin{proof}
    Пусть $\ideal{n} = (\omega_1, \dots, \omega_n)_{\mathbb{Z}}$ и $a = \sum\limits_{i = 1}^n \alpha_i e_i$.
    Обозначим $\theta = \textrm{НОК}(\elementnorm{\omega_1}, \dots, \elementnorm{\omega_n})$.
    Нетрудно видеть, что $\theta \in \ideal{n}$.
    Следовательно, $\theta \equiv 0 \pmod{\ideal{n}}$.
    Тогда $a \equiv a - \beta\theta \pmod{\ideal{n}}$ для любого $\beta \in R$.
    Положим
    \begin{equation*}
        \beta = \sum\limits_{i = 1}^n \beta_i e_i,
    \end{equation*}
    где $\alpha_i = \theta \beta_i + r_i$, $r_i < \theta,\,i = \overline{1,n}$, а также $z = a - \beta\theta$.
    
    Тогда
    \begin{equation*}
        l(z) = \max\limits_{i = \overline{1,n}} |r_i| \leq |\theta| \leq \prod\limits_{i = 1}^n \elementnorm{\omega_i} \leq D^n \prod\limits_{i = 1}^n l(\omega_i) \leq D^n l(\ideal{n})^n = N l(\ideal{n})^n.
    \end{equation*}
    
    Нетрудно видеть, что рассмотренные операции могут быть выполнены за $\tilde{O}(\log L)$ бинарных операций.
\end{proof}

\begin{corollary}
    Пусть $k \in \mathbb{N}$ и $a, b \in \zeroless{R}$, $\ideal{n}$ -- нетривиальный идеал заданный с помощью $\mathbb{Z}$-представления.
    Пусть выполнено $l(a) \leq L$, $l(b) \leq L$, $l(\ideal{n}) \leq L$.
    Элементы $a + b \pmod{\ideal{n}}$ и $a^k \pmod{\ideal{n}}$, $l(z_1) \leq N l(\ideal{n})^n$, $l(z_2) \leq N l(\ideal{n})^n$, могут быть определены за $\tilde{O}(\log L)$, $\tilde{O}(\log k \log L)$  бинарных операций соответственно.
\end{corollary}

\begin{remark}
    Отметим, что все указанные операции могут быть выполнены за полиномиальное время в случае, когда идеалы заданы с помощью одного из представлений: $\mathbb{Z}$-представление, 2-представление, нормальная эрмитовая форма; в силу того, что из одного представления может быть получено другое за полиномиальное время.
\end{remark}

\begin{statement}\cite{source:Wikstrom}
    Пусть $R$ кольцо целых алгебраических элементов числового поля.
    Тогда для любых $a, b \in R$ наибольший общий делитель $(a, b)$ можно вычислить на $O(n^2)$ арифметических операций в $\mathbb{Z}$, где $n$ длина бинарной записи $a$ и $b$.
\end{statement}

\begin{statement}[Теорема Дедекинда]\label{statement:dedekind}
    Пусть $f(T)$ минимальный многочлен алгебраического числа $\theta$ в $\mathbb{Z}[\theta]$.
    Для простого рационального числа $p$, не делящего индекс $[\mathcal{O}_K:\mathbb{Z}[\theta]]$, запишем
    \begin{equation}
        f(T) \equiv \pi_1(T)^{e_1}\dots \pi_g(T)^{e_g} \modul p,\nonumber
    \end{equation}
    где $\pi_i(T)$ --- различные монические неприводимые многочлены в $\mathbb{F}_p[T]$.
    Тогда
    \begin{equation}
        (p) = \mathfrak{p}_1^{e_1}\dots \mathfrak{p}_g^{e_g},\nonumber
    \end{equation}
    где $\mathfrak{p}_i = (p_i, T_i(\theta))$, $T_i(T) \equiv \pi_i(T)(\modul p)$.
\end{statement}

\begin{statement}[Теорема Копперсмита]\label{statement:coppersmith}
    Пусть
    \begin{equation*}
        f(x, y) = \sum\limits_{i, j = 0}^{\delta} p_{i, j} x^i y^j
    \end{equation*}
    неприводимый многочлен от двух переменных над $\mathbb{Z}$.
    Пусть $X, Y \ge 0$ такие, что $|x_0| \le X$ и $|y_0| \le Y$, где $(x_0, y_0)$ решение уравнения $f(x, y) = 0$.
    Обозначим
    \begin{equation*}
        W = \max_{i, j} |p_{i, j}| X^i Y^j.
    \end{equation*}
    Пусть $XY < W^{\frac{3}{2\delta}}$, то существует полиномиальный относительно $\log W$ и $2^\delta$ алгоритм, который позволяет найти такую пару $(x_0, y_0)$, что $f(x_0, y_0) = 0$, $|x_0| \le X$ и $|y_0| \le Y$.
\end{statement}

\section{Аналог критерия Эйлера}

\begin{definition}
    Пусть характер $\chi$ задан на множестве идеалов кольца $R$, не является главным и определен по модулю идеала $\ideal{n} \subset R$.
    Через $\ideal{p}_{\chi}$ обозначим идеал минимальной нормы, для которого $\chi(\ideal{p}_{\chi}) \neq 0, 1$.
\end{definition}

\begin{definition}
    Пусть $R$ дедекиндово кольцо с полем частных $K$ и $L$ расширение поля $K$ степени не меньше $2$.
    Будем говорить, что кольцо $R$ \emph{удовлетворяет условию A для идеала $\ideal{n}$}, если существует многочлен $f_R$, что для любого характера $\chi$, не являющегося главным и определенного по модулю $\ideal{n}$, выполнено
    \begin{equation*}
        \Nm{\ideal{p}_{\chi}} \le f_R(\log{\Nm{\ideal{n}}}).
    \end{equation*}
\end{definition}

\begin{remark}
    Из работы Баха~\cite{source:Bach} следует, что, если расширенная гипотеза Римана выполнена, то условие A выполнено для всех колец $\mathcal{O}_K$ целых алгебраических чисел числового поля $K$ и $f_{\mathcal{O}_K}(x) = 12x^2 + 12\log^2 \Delta_{K}$.
\end{remark}

\begin{remark}
    Из работы Анкени~\cite{source:Ankeny} следует, что, если обобщенная гипотеза Римана выполнена, то условие A выполнено для кольца целых чисел и $f_{\mathbb{Z}}(x) = 2x^2$.
\end{remark}

\begin{proposition}\label{proposition:condition_A_with_any_homomorphism}
    Пусть кольцо $R$ удовлетворяет условию A.
    Пусть $\chi: \invertible{R/\ideal{n}} \to G$ нетривиальный гомоморфизм.
    Тогда существует идеал $a$ взаимнопростой с $\ideal{n}$ и такой, что $\chi(a) \neq 1$ и
    \begin{equation*}
        \Nm{a} \le f(\log{\Nm{\ideal{n}}}).
    \end{equation*}
\end{proposition}
\begin{proof}
    Из условия предложения следует, что подгруппа $\chi(\invertible{R/\ideal{n}}) \subseteq G$ нетривиальная.
    Рассмотрим нетривиальный характер $\xi: \chi(\invertible{R/\ideal{n}}) \to \invertible{\mathbb{C}}$.
    Очевидно, что $\xi \circ \chi: \invertible{R/\ideal{n}} \to \invertible{\mathbb{C}}$ является нетривиальным характером группы $\invertible{R/\ideal{n}}$.
    
    Из определения условия A следует, что существует простой $a$ взаимнопростой с $\ideal{n}$ и такой, что $(\xi \circ \chi)(a) \neq 1$ и
    \begin{equation*}
        \Nm{a} \le f(\log{\Nm{\ideal{n}}}).
    \end{equation*}
    
    Из того, что $(\xi \circ \chi)(a) \neq 1$ следует, что $\chi(a) \neq 1$.
\end{proof}

\begin{proposition}\label{proposition:miller_criteria_character}
    Пусть идеал $\ideal{p}$ простой с нечетной нормой.
    Тогда сравнение
    \begin{equation*}
        \ideal{x}^{\Nm{\ideal{p}} - 1} \equiv 1 \pmod{\ideal{p}^2}
    \end{equation*}
    имеет не более $\Nm{\ideal{p}} - 1$ решений относительно $\ideal{x} \in \invertible{R/\ideal{p}^2}$.
\end{proposition}
\begin{proof}
    Из утверждения~\ref{statement:euler_function} следует, что сравнение $\ideal{x}^{\Nm{\ideal{p}} - 1} \equiv 1 \pmod{\ideal{p}}$ имеет ровно $\Nm{\ideal{p}} - 1$ решений относительно $\ideal{x} \in \invertible{R/\ideal{p}}$.
    
    Заметим, что все решения сравнения $\ideal{x}^{\Nm{\ideal{p}} - 1} \equiv 1 \pmod{\ideal{p}^2}$ имеют вид $a + \ideal{p}\ideal{t}$, где $a \in \invertible{R/\ideal{p}}$, $\ideal{t} \in R/\ideal{p}$ и $a$ является решением сравнения $\ideal{x}^{\Nm{\ideal{p}} - 1} \equiv 1 \pmod{\ideal{p}}$.
    Подставим этот вид в сравнение, раскроем скобки и получим сравнение
    \begin{equation*}
        \ideal{p}\ideal{t}(\Nm{\ideal{p}} - 1)a^{\Nm{\ideal{p}} - 2} \equiv 1 - a^{\Nm{\ideal{p}} - 1} \pmod{\ideal{p}^2}.
    \end{equation*}
    
    Так как $((\Nm{\ideal{p}} - 1)a^{\Nm{\ideal{p}} - 2}, \ideal{p}) = 1$, то это сравнение имеет ровно одно решение при фиксированном $a$.
    Следовательно, исходное сравнение имеет не более $\Nm{\ideal{p}} - 1$ решений относительно $\ideal{x} \in \invertible{R/\ideal{p}^2}$.
\end{proof}

\begin{theorem}\label{theorem:euler_criteria}
    Пусть $\ideal{n}$ -- нетривиальный идеал нечетной нормы дедекиндового кольца $R$.
    Тогда $\ideal{n}$ -- простой идеал тогда и только тогда, когда для любого $a \in \invertible{R/\ideal{n}}$ выполнено
    \begin{equation*}
        a^{\frac{\Nm{\ideal{n}} - 1}{2}} \equiv \jacobi{a}{\ideal{n}} \pmod{\ideal{n}}.
    \end{equation*}

    Если кольцо $R$ факториальное и удовлетворяет условию A, то $\ideal{n}$ -- простой идеал тогда и только тогда, когда для любого $a \in \invertible{R/\ideal{n}}$, $\Nm{a} \le f_R(\Nm{\ideal{n}})$ выполнено
    \begin{equation*}
        a^{\frac{\Nm{\ideal{n}} - 1}{2}} \equiv \jacobi{a}{\ideal{n}} \pmod{\ideal{n}}.
    \end{equation*}
\end{theorem}
\begin{proof}
    Докажем первую часть теоремы.
    Предположим, что $\ideal{n}$ -- простой идеал.
    Рассмотрим произвольный $a \in \invertible{R/\ideal{n}}$.
    Пусть $g$ -- первообразный корень по модулю $\ideal{n}$.

    Так как $\Nm{\ideal{n}}$ нечетный, то $a$ является квадратичным вычетом тогда и только тогда, когда существует такое $t' = 2t \in \{0, 2, \dots, \Nm{\ideal{n}} - 1\}$, что $a \equiv g^{t'} \pmod{\ideal{n}}$.
    Так как порядок $g$ равен $\Nm{\ideal{n}} - 1$, то последнее сравнение выполняется тогда и только тогда, когда $a^{\frac{\Nm{\ideal{n}} - 1}{2}} \equiv 1 \pmod{\ideal{n}}$.
    Это завершает доказательство необходимости.

    Предположим, что $\ideal{n}$ -- не простой идеал.
    Пусть $\ideal{n}$ раскладывается в произведение простых идеалов следующим образом $\ideal{n} = \prod_{i=1}^{r} \ideal{p}_i^{\alpha_i}$.
    Так как норма простого идеала примарная, то обозначим $\Nm{\ideal{p}_i} = q_i^{f_i}$, где $q_i$ -- простой в $\mathbb{Z}$.
    Пусть для любого $a \in \invertible{R/\ideal{n}}$ выполнено $a^{\frac{\Nm{\ideal{n}} - 1}{2}} \equiv \left[\frac{a}{\ideal{n}}\right] \pmod{\ideal{n}}$.

    Пусть существует такой $j \in \{1, \dots, r\}$, что $\alpha_j > 1$ в разложении $\ideal{n}$ на множители.
    Из теоремы Коши для групп \ref{statement:cauchy} и свойств функции Эйлера \ref{statement:euler_function} следует, что существует $a \in \invertible{R/\ideal{n}}$ порядка $q_j$.
    Тогда $q_j | \Nm{\ideal{n}} - 1$, что невозможно.

    Следовательно, $\alpha_j = 1$ для любого $j \in \{1, \ldots, r\}$.
    Так как $\ideal{n}$ -- составное, то $r \ge 2$.
    Рассмотрим произвольный квадратичный невычет $b \in \invertible{R/\ideal{p}_1}$.
    Согласно аналогу Китайской теоремы об остатках \ref{statement:chinese_remainder_theorem} существует такой $a \in \invertible{R/\ideal{n}}$, что выполнено $a \equiv b \pmod{\ideal{p}_1}$ и $a \equiv 1 \pmod{\ideal{p}_2\dots\ideal{p}_r}$.
    Но в этом случае $\jacobi{a}{\ideal{n}} = -1$.
    Из условия теоремы следует, что $a^{\frac{\Nm{\ideal{n}} - 1}{2}} \equiv -1 \pmod{\ideal{n}}$, что противоречит условию $a \equiv 1 \pmod{\ideal{p}_2}$.
    Это завершает доказательство достаточности.

    Теперь докажем вторую часть.
    Необходимость следует из доказанного ранее.
    Идеал $\ideal{n}$ не может быть простым, если существует $a \in \invertible{R/\ideal{n}}$, для которого
    \begin{equation*}
        a^{\frac{\Nm{\ideal{n}} - 1}{2}} \not\equiv \jacobi{a}{\ideal{n}} \pmod{\ideal{n}}.
    \end{equation*}

    Предположим, что $\ideal{n} \in \zeroless{R} \setminus \invertible{R}$ составной идеал нечетной нормы и для любого и идеала $a \in \invertible{R/\ideal{n}}$, $\Nm{a} \le f_R(\Nm{\ideal{n}})$ выполнено
    \begin{equation*}
        a^{\frac{\Nm{\ideal{n}} - 1}{2}} \equiv \jacobi{a}{\ideal{n}} \pmod{\ideal{n}}.
    \end{equation*}
    
    Рассмотрим такое отображение $\chi: \invertible{R/\ideal{n}} \to \invertible{R/\ideal{n}}$, что для всех $a \in \invertible{R/\ideal{n}}$ выполнено $\chi(a) = a^{(\Nm{\ideal{n}} - 1)/2}\jacobi{a}{\ideal{n}}$.
    Из теоремы~\ref{theorem:euler_criteria} следует, что $\chi$ нетривиальный гомоморфизм.
    
    Тогда, используя предложение~\ref{proposition:condition_A_with_any_homomorphism}, получаем, что существует такой идеал $a \in \invertible{R/\ideal{n}}$, что
    \begin{equation*}
        a^{\frac{\Nm{\ideal{n}} - 1}{2}} \jacobi{a}{\ideal{n}} \not\equiv 1 \pmod{\ideal{n}}.
    \end{equation*}
    Получили противоречие.
\end{proof}

\begin{algorithm}\label{algorithm:solovay_strassen}
    Дан нетривиальный идеал $\ideal{n} \subset R$.
    Необходимо определить является ли он простым.

    \begin{enumerate}
        \item Вычислить $\Nm{\ideal{n}}$;
        
        \item Выбрать случайное $a \in \invertible{R/\ideal{n}}$;

        \item Вычислить $r_0 = a^{\frac{\Nm{\ideal{n}} - 1}{2}} \pmod{\ideal{n}}$, $r_1 = \jacobi{a}{\ideal{n}}$;

        \item Если $r_0 \equiv r_1 \pmod{\ideal{n}}$, то вернуть ''неизвестно'' и завершить алгоритм;

        \item Вернуть ''$\ideal{n}$ не простой'' и завершить алгоритм.
    \end{enumerate}
\end{algorithm}

\begin{remark}
    Алгоритм \ref{algorithm:solovay_strassen} является вероятностным.
    Если был получен ответ "неизвестно", то можно выполнить алгоритм еще раз.
\end{remark}

\begin{proposition}
    Пусть $\ideal{n}$ -- не простой идеал.
    Тогда вероятность ответа "$\ideal{n}$ не простой" у алгоритма \ref{algorithm:solovay_strassen} не менее $1/2$.
\end{proposition}
\begin{proof}
    Рассмотрим множество
    \begin{equation*}
        G = \left\{
            a \in \invertible{R/\ideal{n}} \big| a^{\frac{\Nm{\ideal{n}} - 1}{2}} \equiv \jacobi{a}{\ideal{n}} \pmod{\ideal{n}}
        \right\}.
    \end{equation*}
    Алгоритм~\ref{algorithm:solovay_strassen} возвращает ответ ''неизвестно'' только для элементов из множества $G$.

    Заметим, что если алгоритм~\ref{algorithm:solovay_strassen} возвращает ответ ''неизвестно'' для $a$ и $b$, то он вернет ответ ''неизвестно'' и для $ab$.
    Следовательно, $G$ образует подгруппу группы $\invertible{R/\ideal{n}}$.

    Из теоремы~\ref{theorem:euler_criteria} следует, что $G$ собственная подгруппа.
    Тогда из теоремы Лагранжа~\ref{statement:lagrange} следует, что $|G|/|\invertible{R/\ideal{n}}| \le \frac{1}{2}$.
\end{proof}

\begin{remark}
    Если $\ideal{n}$ -- составной, то при выполнении алгоритма \ref{algorithm:miller_rabin} $k$ раз вероятность получить ответ ''$\ideal{n}$ не простой'' не меньше $1 - \frac{1}{2^k}$.
\end{remark}

\section{Аналог критерия Миллера}

\begin{theorem}\label{theorem:miller_criteria}
    Пусть $\ideal{n}$ -- нетривиальный идеал нечетной нормы дедекиндового кольца $R$.
    Пусть $\Nm{\ideal{n}} - 1 = 2^t u$, $(u, 2) = 1$.
    Тогда $\ideal{n}$ -- простой идеал тогда и только тогда, когда для любого $a \in \invertible{R/\ideal{n}}$, $a^u \not\equiv 1 \pmod{\ideal{n}}$ существует $k\in \{0, \dots, t-1\}$, такое что $a^{2^{k}u} \equiv -1 \pmod{\ideal{n}}$.

    Пусть кольцо $R$ факториальное и удовлетворяет условию A.
    Тогда $\ideal{n}$ -- простой идеал тогда и только тогда, когда для любого $a \in \invertible{R/\ideal{n}}$, $\Nm{a} \le f_R(\Nm{\ideal{n}})$, $(a, \ideal{n}) = 1$, $a^u \not\equiv 1 \pmod{\ideal{n}}$ существует $k\in \{0, \dots, t-1\}$, такое что $a^{2^{k}u} \equiv -1 \pmod{\ideal{n}}$.
\end{theorem}
\begin{proof}
    Докажем первую часть теоремы.
    Предположим, что $\ideal{n}$ -- простой идеал.
    Рассмотрим произвольный $a \in \invertible{R/\ideal{n}}$, $a^u \not\equiv 1 \pmod{\ideal{n}}$.
    Из теоремы Эйлера \ref{statement:euler_function} следует, что:
    \begin{equation*}
        a^{2^{t} u} = a^{\varphi(\ideal{n})} \equiv 1 \pmod{\ideal{n}}
    \end{equation*}

    Раскладываем на множители и получаем, что выполнено
    \begin{equation*}
        (a^{u} - 1)(a^{u} + 1)(a^{2u} + 1)\dots(a^{2^{t-1}u} + 1) \equiv 0 \pmod{\ideal{n}}
    \end{equation*}

    Из того, что $a^{u} \not\equiv 1 \pmod{\ideal{n}}$ следует, что $a^{2^{k}u} + 1 \equiv 0 \pmod{\ideal{n}}$ для некоторого $k\in \{0, \dots, t-1\}$.
    Это завершает доказательство необходимости.

    Предположим, что $\ideal{n}$ -- не простой идеал.
    Пусть $\ideal{n}$ раскладывается в произведение простых идеалов следующим образом $\ideal{n} = \prod_{i=1}^{r} \ideal{p}_i^{\alpha_i}$.
    Так как норма простого идеала примарная, то обозначим $\Nm{\ideal{p}_i} = q_i^{f_i}$, где $q_i$ -- простой в $\mathbb{Z}$.

    Пусть существует такой $j \in \{1, \dots, r\}$, что $\alpha_j > 1$ в разложении $\ideal{n}$ на множители.
    Из теоремы Коши для групп \ref{statement:cauchy} и свойств функции Эйлера~\ref{statement:euler_function} следует, что существует $a \in \invertible{R/\ideal{n}}$ порядка $q_j$.
    Так как $u \not\equiv 0 \pmod{q_j}$, то $a^u \not\equiv 1 \pmod{\ideal{n}}$.
    Следовательно, существует число $k \in \{1, \dots, t-1\}$, такое что выполнено сравнение $a^{2^{k}u} \equiv -1 \pmod{\ideal{n}}$.
    Тогда $a^{2^{k+1}u} \equiv 1 \pmod{\ideal{n}}$.
    Значит выполнено $2^{k+1}u \equiv 0 \pmod{q_j}$.
    Из последнего сравнения следует, что $\Nm{\ideal{n}} - 1 \equiv 0 \pmod{q_j}$, что невозможно.
    
    Следовательно, $\alpha_j = 1$ для любого $j \in \{1, \ldots, r\}$.
    Так как $\ideal{n}$ -- составное, то $r \ge 2$.
    Из аналога Китайской теоремы об остатках~\ref{statement:chinese_remainder_theorem} и того, что элемент $-1$ имеет порядок $2$ в каждой группе $\invertible{R/\ideal{p}_j}$ следует, что существует по крайней мере $2^r-1 \ge 3$ элемента $\invertible{R/\ideal{n}}$ порядка $2$.
    Пусть $a \not\equiv \pm 1 \pmod{\ideal{n}}$ является произвольным элементом порядка $2$ в группе $\invertible{R/\ideal{n}}$.
    Из того, что $(u, 2) = 1$ следует, что $a^u \equiv a \not\equiv \pm 1 \pmod{\ideal{n}}$.
    Таким образом, существует $k \in \{0,\ldots, t-1\}$, такое что верно $a^{2^{k}u} \equiv -1 \pmod{\ideal{n}}$.
    Это противоречит тому, что порядок $a$ равен $2$.
    Это завершает доказательство достаточности.

    Теперь докажем вторую часть теоремы.
    Необходимость следует из доказанного ранее.

    Предположим, что $\ideal{n} \in \zeroless{R} \setminus \invertible{R}$ составной идеал нечетной нормы и для любого $a \in \invertible{R/\ideal{n}}$, $\Nm{a} \le f_R(\Nm{\ideal{n}})$, $(a, \ideal{n}) = 1$, $a^u \not\equiv 1 \pmod{\ideal{n}}$ существует $k\in \{0, \dots, t-1\}$, такое что $a^{2^{k}u} \equiv -1 \pmod{\ideal{n}}$.

    Предположим, что существует такой простой идеал $\ideal{p}$, что $\ideal{p}^2 | \ideal{n}$.
    Рассмотрим такое отображение $\chi: \invertible{R/\ideal{p}^2} \to \invertible{R/\ideal{p}^2}$, что для всех $a \in \invertible{R/\ideal{p}^2}$ выполнено $\chi(a) = a^{\Nm{\ideal{p}} - 1}$.
    Из предложения~\ref{proposition:miller_criteria_character} следует, что это нетривиальный гомоморфизм.
    Тогда, из предложения~\ref{proposition:condition_A_with_any_homomorphism}, получаем, что существует такой элемент $a \in \invertible{R/\ideal{p}^2}$, что
    \begin{equation*}
        a^{\Nm{\ideal{p}} - 1} \not\equiv 1 \pmod{\ideal{p}^2}.
    \end{equation*}

    Предположим, что $a^{\Nm{\ideal{n}} - 1} \equiv 1 \pmod{\ideal{n}}$.
    Тогда $a^{\Nm{\ideal{n}} - 1} \equiv 1 \pmod{\ideal{p}^2}$.
    Тогда $\textrm{ord}_{R/\ideal{p}^2}(a) | \Nm{\ideal{n}} - 1$ и $\textrm{ord}_{R/\ideal{p}^2}(a) | \varphi(\ideal{p}^2)$.
    Из этого следует, что $\textrm{ord}_{R/\ideal{p}^2}(a) | \Nm{\ideal{p}} - 1$.
    Это противоречит выражению $a^{\Nm{\ideal{p}} - 1} \not\equiv 1 \pmod{\ideal{p}^2}$.

    Следовательно, не существует такой простой идеал $\ideal{p}$, что $\ideal{p}^2 | \ideal{n}$.
    Пусть $\ideal{p}$ и $\ideal{q}$ различные простые делители $\ideal{n}$.
    
    Обозначим $v_2(n)$ максимальную степень двойки, делящую $n \in \mathbb{Z}$.
    Не нарушая общности, предположим, что $v_2(\Nm{\ideal{p}} - 1) \ge v_2(\Nm{\ideal{q}} - 1)$.
    Пусть
    \begin{equation*}
        \ideal{d} = \begin{cases}
            \ideal{p}\ideal{q} &\textrm{ если } v_2(\Nm{\ideal{p}} - 1) = v_2(\Nm{\ideal{q}} - 1)\\
            \ideal{p} &\textrm{ если } v_2(\Nm{\ideal{p}} - 1) > v_2(\Nm{\ideal{q}} - 1).
        \end{cases}
    \end{equation*}
    Рассмотрим такое отображение $\xi: \invertible{R/\ideal{n}} \to \invertible{R/\ideal{n}}$, что для всех $a \in \invertible{R/\ideal{n}}$ выполнено $\xi(a) = \jacobi{a}{\ideal{d}}$.
    Это отображение является нетривиальным гомоморфизмом.
    Тогда, из предложения~\ref{proposition:condition_A_with_any_homomorphism}, получаем, что существует такой элемент $a \in \invertible{R/\ideal{n}}$, что
    \begin{equation*}
        \jacobi{a}{\ideal{d}} \not\equiv 1 \pmod{\ideal{n}}.
    \end{equation*}
    
    Положим $\ideal{b} = a^u$.
    Тогда $\jacobi{b}{\ideal{d}} = -1$.
    Следовательно, $\ideal{b} \not\equiv 1 \pmod{\ideal{d}}$.
    Пусть $j \in \mathbb{Z}$ минимальное число, для которого $a^{2^j u} \equiv -1 \pmod{\ideal{n}}$.
    Тогда $\textrm{ord}_{R/\ideal{p}}(\ideal{b}) = \textrm{ord}_{R/\ideal{q}}(\ideal{b}) = 2^{j+1}$.
    
    Рассмотрим два случая.
    Пусть $v_2(\Nm{\ideal{p}} - 1) > v_2(\Nm{\ideal{q}} - 1)$.
    Тогда $\textrm{ord}_{R/\ideal{q}}(\ideal{b}) = 2^{j+1} | \varphi(\ideal{q}) = \Nm{\ideal{q}} - 1$.
    Следовательно, $\textrm{ord}_{R/\ideal{p}}(\ideal{b}) = 2^{j+1} | (\Nm{\ideal{p}} - 1)/2$.
    Получаем, что $\jacobi{b}{\ideal{d}} = \jacobi{a}{\ideal{p}} = -1$ и $\ideal{b}^{(\Nm{\ideal{p}} - 1)/2} \equiv 1 \pmod{\ideal{p}}$.
    Это противоречит теореме~\ref{theorem:euler_criteria}.
    
    Пусть $v_2(\Nm{\ideal{p}} - 1) = v_2(\Nm{\ideal{q}} - 1)$.
    Тогда $\jacobi{b}{\ideal{d}} = \jacobi{b}{\ideal{p}}\jacobi{b}{\ideal{q}} = -1$.
    Следовательно, один из множителей равен $-1$.
    Пусть $\jacobi{b}{\ideal{p}} = -1$ и $\jacobi{b}{\ideal{q}} = 1$.
    Из теоремы~\ref{theorem:euler_criteria} следует, что $\ideal{b}^{(\Nm{\ideal{q}} - 1)/2} \equiv 1 \pmod{\ideal{q}}$ и $\textrm{ord}_{R/\ideal{p}}(\ideal{b}) = \textrm{ord}_{R/\ideal{q}}(\ideal{b}) | (\Nm{\ideal{q}} - 1)/2$.
    Тогда $\textrm{ord}_{R/\ideal{p}}(\ideal{b}) | (\Nm{\ideal{p}} - 1)/2$.
    Следовательно, $\ideal{b}^{(\Nm{\ideal{p}} - 1)/2} \equiv 1 \pmod{\ideal{p}}$, что противоречит предположению $\jacobi{b}{\ideal{p}} = -1$.
\end{proof}

\begin{algorithm}\label{algorithm:miller_rabin}
    Дан идеал $\ideal{n} \subset R$.
    Необходимо определить является ли он простым.

    \begin{enumerate}
        \item Найти $u, t \in \mathbb{N}$, что $\Nm{\ideal{n}} - 1 = 2^t u$ и $(2, u) = 1$;
        
        \item Выбрать случайный $a \in \invertible{R/\ideal{n}}$;

        \item Вычислить $r_0 = a^u \pmod{\ideal{n}}$;

        \item Если $r_0 = 1$, то вернуть ''неизвестно'' и завершить алгоритм;

        \item Положить $k = 0$;

        \item Пока $k < t$ выполнять:
        \begin{enumerate}
            \item Если $r_k = -1$, то вернуть ''неизвестно'' и завершить алгоритм;

            \item Увеличить $k$ на $1$;

            \item Вычислить $r_{k+1} \equiv r_k^2 \pmod{\ideal{n}}$;
        \end{enumerate}

        \item Вернуть ''$\ideal{n}$ не простой'' и завершить алгоритм.
    \end{enumerate}
\end{algorithm}

\begin{remark}
    Алгоритм \ref{algorithm:miller_rabin} является вероятностным.
    Если был получен ответ "неизвестно", то можно выполнить алгоритм еще раз.
\end{remark}

\begin{proposition}
    Пусть $\ideal{n}$ -- не простой идеал.
    Тогда вероятность ответа "$\ideal{n}$ не простой" у алгоритма \ref{algorithm:miller_rabin} не менее $1/2$.
\end{proposition}
\begin{proof}
    Рассмотрим множество всех $a$, для которых алгоритм дает ответ "неизвестно".
    Это в точности множество таких $a$, что $a^u \equiv 1 \pmod{\ideal{n}}$ или для которых существует $j \in \{0, \dots, t-1\}$, что $a^{2^{j}u} \equiv -1 \pmod{\ideal{n}}$.
    Из этого следует, что $a^{\Nm{\ideal{n}} - 1} \equiv 1 \pmod{\ideal{n}}$ для всех таких $a$.

    Рассмотрим множество
    \begin{equation*}
        G = \left\{
            a \in \invertible{R/\ideal{n}} \big| a^{\Nm{\ideal{n}} - 1} \equiv 1 \pmod{\ideal{n}}
        \right\}.
    \end{equation*}
    Предположим, что $G$ -- нетривиальная подгруппа.
    Тогда из теоремы Лагранжа следует, что $|G| / |\invertible{R/\ideal{n}}| \le 1/2$.
    Из этого следует верность теоремы для этого случая.

    Предположим, что $\ideal{n}$ такой, что $G = \invertible{R/\ideal{n}}$.
    Пусть $\ideal{n}$ раскладывается в произведение простых идеалов следующим образом $\ideal{n} = \prod_{i=1}^r \ideal{p}_i^{\alpha_i}$.
    Так как норма простого идеала примарная, то обозначим $\Nm{p_i} = q_i^{f_i}$, где $q_i$ -- простой в $\mathbb{Z}$.

    Предположим, что существует такой $j \in \{1, \dots, r\}$, что $\alpha_i > 1$ в разложении $\ideal{n}$ на множители.
    Тогда $\Nm{\ideal{p}_j} | \varphi(\ideal{n})$, следовательно $q_j | \varphi(\ideal{n})$.
    Из теоремы Коши для групп~\ref{statement:cauchy} следует, что в группе $\invertible{R/\ideal{n}}$ существует элемент $a$ порядка $q_j$.
    Из теоремы Эйлера~\ref{statement:euler_function} следует, что $a^{\Nm{\ideal{n}} - 1} \equiv 1 \pmod{\ideal{n}}$, следовательно, $a^{\Nm{\ideal{n}} - 1} \equiv 1 \pmod{\ideal{p}}$.
    Из утверждений выше получаем, что $q_j | \Nm{\ideal{n}} - 1$.
    Это противоречит тому, что $q_j | \Nm{\ideal{n}}$.

    Следовательно, $\alpha_j = 1$ для любого $j \in \{1, \dots, r\}$.
    Так как $\ideal{n}$ -- составное, то $r \ge 2$.
    Обозначим $\Nm{\ideal{p}_i} - 1 = 2^{t_i} u_i$, где $(u_i, 2) = 1$.
    Так же обозначим $s = \min_{i=\overline{1, r}} t_i$, $P = \prod_{i=1}^r (u_i, u)$.

    Из аналога Китайской теоремы об остатках~\ref{statement:chinese_remainder_theorem} следует, что
    \begin{equation*}
        a^u \equiv 1 \pmod{\ideal{n}}
        \Leftrightarrow
        a^u \equiv 1 \pmod{\ideal{p}_i}, i=\overline{1, r}.
    \end{equation*}

    Из теоремы Эйлера~\ref{statement:euler_function} следует, что
    \begin{equation*}
        a^u \equiv 1 \pmod{\ideal{p}_i}
        \Leftrightarrow
        \lambda u \equiv 0 \pmod{\Nm{\ideal{p}_i} - 1},
    \end{equation*}
    где $a \equiv g^\lambda \pmod{\ideal{p}_i}$ и $g$ -- первообразный корень $\invertible{R/\ideal{p}_i}$.
    Так как последнее сравнение имеет $(u, \Nm{\ideal{p}_i} - 1)$ решений, то количество решений сравнения $a^u \equiv 1 \pmod{\ideal{n}}$ равно
    \begin{equation*}
        \prod_{i=1}^r (u, \Nm{\ideal{p}_i} - 1) = P.
    \end{equation*}

    Аналогично получаем, что
    \begin{equation*}
        a^{2^j u} \equiv -1 \pmod{\ideal{n}}
        \Leftrightarrow
        \lambda 2^j u \equiv \frac{\Nm{\ideal{p}_i} - 1}{2} \pmod{\Nm{\ideal{p}_i} - 1}, i=\overline{1, r}.
    \end{equation*}
    Заметим, что сравнение $\lambda 2^j u \equiv \frac{\Nm{\ideal{p}_i} - 1}{2} \pmod{\Nm{\ideal{p}_i} - 1}$ не имеет решений при $j \ge t_i$ и имеет $(2^j u, \Nm{\ideal{p}_i} - 1)$ решений при $j < t_i$.
    Тогда количество решений $a^{2^j u} \equiv -1 \pmod{\ideal{n}}$ равно
    \begin{equation*}
        \prod_{i=1}^r (2^j u, \Nm{\ideal{p}_i} - 1) = 2^{jr} \prod_{i=1}^r (u, \Nm{\ideal{p}_i} - 1) = 2^{jr} P.
    \end{equation*}

    Следовательно, количество идеалов $a \in \invertible{R/\ideal{n}}$, на которых алгоритм дает ответ ''неизвестно'' равно
    \begin{equation*}
        P + \sum_{j=1}^{s-1} 2^{jr} P = P\left(1 + \frac{2^{rs} - 1}{2^r - 1}\right) = P\frac{2^{rs} + 2^r - 2}{2^r - 1}
    \end{equation*}

    Исходя из определения, получаем
    \begin{equation*}
        |\invertible{R/\ideal{n}}| = \varphi(\ideal{n}) = \prod_{i=1}^r \varphi(\ideal{p}_i) = \prod_{i=1}^r (\Nm{\ideal{p}_i} - 1) = \prod_{i=1}^r 2^{t_i} u_i \ge 2^{rs} P.
    \end{equation*}

    Таким образом
    \begin{equation*}
        |G|/|\invertible{R/\ideal{n}}| \le \frac{2^{rs} + 2^r - 2}{2^{rs}(2^r - 1)} \le \frac{1}{2}.
    \end{equation*}
\end{proof}

\begin{remark}
    Если $\ideal{n}$ -- составной, то при выполнении алгоритма \ref{algorithm:miller_rabin} $k$ раз вероятность получить ответ ''$\ideal{n}$ не простой'' не меньше $1 - \frac{1}{2^k}$.
\end{remark}

\begin{remark}
    Доказанные критерии и алгоритмы можно использовать при генерации простых идеалов.
    В частности для кольца целых чисел они используются в алгоритме Гордона построения сильных простых чисел.
    Генерация простых идеалов является обязательной частью в RSA-криптосистеме в дедекиндовых кольцах.
    Такая криптосистема будет рассмотрена в главе~\ref{section:RSA-cryptosystem}.
\end{remark}

\section{Вычислительная сложность алгоритма Миллера-Рабина}

\begin{proposition}
    Пусть $\ideal{n} \subseteq R$ идеал дедекиндового кольца $R$.
    Для того, чтобы использовать алгоритм~\ref{algorithm:miller_rabin} для $\ideal{n}$ требуется $O(\log \Nm{\ideal{n}})$ арифметических операций.
\end{proposition}
\begin{proof}
    Пусть $\Nm{\ideal{n}} = 2^t u$, где $(2, u) = 1$.
    В алгоритме~\ref{algorithm:miller_rabin} выбирается произвольный $a \in R$ и вычисляется $r_0 = a^u \pmod{\ideal{n}}$.
    Это требует $O(\log u)$ арифметических операций.
    Далее не более $t$ раз для $r_i$ вычисляется $r_i^2 \pmod{\ideal{n}}$.
    Это требует не более $O(t)$ арифметических операций.

    Итого требуется $O(\log u) + O(t) = O(\log \Nm{\ideal{n}})$ арифметических операций.
\end{proof}

\begin{proposition}
    Пусть $K$ числовое поле и $R$ кольцо целых алгебраических элементов числового поля $K$.
    Пусть $\ideal{n} \subseteq R$ идеал кольца $R$.
    Для того, чтобы использовать алгоритм~\ref{algorithm:miller_rabin} для $\ideal{n}$ требуется $\tilde{O}(\log^2 l(\ideal{n}))$ бинарных операций.
\end{proposition}
\begin{proof}
    Очевидным образом следует из оценок сложностей операций над элементами и идеалами в кольце целых алгебраических элементов числового поля, которые были описаны ранее.
\end{proof}

\section*{Выводы по главе \ref{chapter:Primality}}
\addcontentsline{toc}{section}{Выводы по главе \ref{chapter:Primality}}

\onlyinsubfile{
    \subfile{_10_bibliography}
    \subfile{_11_pub}
}

\end{document}
